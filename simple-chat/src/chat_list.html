<!DOCTYPE html>

<html>
    <head lang="en">
        <meta charset="UTF-8">
        <title>Message list</title>
        <link href="./src/css/chat_list.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <meta name="viewport" content="width=device-width, user-scalable=no">
    </head>
    <body> 
            <div class = "header">
                <button class="material-icons" >
                    <i class="material-icons">menu</i>
                </button>
                <div class="status">
                    <h2>Messenger</h2>
                    
                </div>
                <div class="material-icons1">
                    <button class="material-icons" >
                        <i class="material-icons">search</i>
                    </button>
                </div>
            </div>
            <div class="chat_field">
                <div class="chat" onclick="window.location.href='index.html';">
                    <div class = "chat-im"> <img src = "/src/photos/Jennifer.jpg" /> </div >
                    <div class = "mes-content">
                        <div class="message-name">Дженнифер</div>
                        <span class="message-text">Привет, Джен, всё нормально, просто на работе завал.</span>
                    </div>
                    <div class="message-meta">
                            <span class="message-status">
                                <i class="material-icons">done_all</i>
                            <span class="message-time">10:53</span>
                    </div>
                </div>
                <div class="chat" onclick="window.location.href='/src/yen.html';">
                    <div class = "chat-im"> <img src = "/src/photos/Yennifer.jpg" /> </div >
                    <div class = "mes-content">
                        <div class="message-name">Йеннифер</div>
                        <span class="message-text">Привет, тебе нравится моя новая аватарка?.</span>
                    </div>
                    <div class="message-meta">
                            <span class="message-time">8:34</span>
                            
                        
                    </div>
                </div>
                <div class="chat" onclick="window.location.href='/src/mike.html';">
                    <div class = "chat-im"> <img src = "/src/photos/Mike.jpg" /> </div >
                    <div class = "mes-content">
                        <div class="message-name">Майк</div>
                        <span class="message-text">Том, у нас горят сроки, ускорься, пожалуйста.</span>
                    </div>
                    <div class="message-meta">
                            <span class="message-time">8:24</span>
                            
                                
                        
                    </div>
                </div>
                <button class="add_button" >
                    <i class="material-icons">add</i>
                </button>
            </div>
        
        <script>
            //import "/src/css/chat_list.css"
            //import "/src/index.html"
            //import "/src/js/index.js"
            //import "/src/chat_list.html"

const chat = document.querySelector('.chat-field');

//chat.addEventListener('click', changePage.bind(this))

function changePage(){
    window.location.href = './index.html'
}

function listeningEvents(){

}

function createNewChat(){

}

function getLastMessage(){
    const text = document.querySelector('.mes-content');
    const meta = document.querySelector('.message-meta');

    let messages = localStorage.getItem("messages");
    if (messages.length == []){
        const defaultText = `
            <span class="message-name">Brad Pitt</span>
            <span class="message-text">Dude, you wanna hang out on Broadway?</span>
        `
        const defaultMeta = `
            <span class="message-time">4:19</span>
            <span class="message-status">
                <i class="material-icons">done_all</i>
            </span>
        `
        text.innerHTML = defaultText
        meta.innerHTML = defaultMeta
        return
    }
    messages = localStorage.getItem("messages");
    messages = JSON.parse(messages);
    //messages.sort((a, b) => {return a["time"] < b["time"]})
    console.log("yes");
    const lastMessage = messages.at(-1);
    console.log(lastMessage);
    const updateChatInfo = `
            <span class="message-name">`+String(lastMessage['reciever'])+`</span>
            <span class="message-text">`+String(lastMessage['text'])+`</span>
        `
        const updateChatMeta = `
            <span class="message-time">`+String(lastMessage['time'])+`</span>
            <span class="message-status">
                <i class="material-icons">done_all</i>
            </span>
        `
            //`+String(lastMessage['reciever'])+`
    console.log(updateChatInfo);
    console.log(updateChatMeta);
    console.log(text);
    console.log(meta);
    text.innerHTML = updateChatInfo;
    meta.innerHTML = updateChatMeta;

    console.log(messages);

}
console.log("yes");
getLastMessage();
        </script>
                
            
    </body>
</html>
